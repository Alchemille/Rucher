{% extends "base.html"%}
{% block content %}
<div class="jumbotron">

    <p>Mon nouveau rucher:</p>

    <form method="POST">
        <!-- quand action = pas precisÃ©, renvoie POST sur la meme page -->
        {# This hidden_tag is a CSRF security feature. #}
        {{ form.hidden_tag() }}
        <p>
            {{form.location.label }} <br> {{form.location}} <br>
            {% for error in form.location.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <p>
            {{ form.plant.label }} <br> {{form.plant}} <br>
            {% for error in form.plant.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <p>
            {{ form.lat.label }} <br> {{form.lat(id="lat", placeholder="Cliquer sur la carte")}} <br>
            {% for error in form.lat.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <p>
            {{ form.longit.label }} <br> {{form.longit(id="long", placeholder="Cliquer sur la carte")}} <br>
            {% for error in form.longit.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </p>
        <br>
        {{ form.submit() }}
    </form>

    <div class="d-flex justify-content-center align-items-center">
        <div class="border border-info" id='map' style='width: 700px; height: 500px;'></div>
          <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoianNvbWEiLCJhIjoibFJmYl9JWSJ9.AUm8d76cbOvVEn2mMeG_ZA';
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/outdoors-v11',
                center: [0.529145, 45.440493],
                zoom: 10
            });
            map.on('load', function () {
                
                var positions = {{ positions| safe }}
                positions.forEach(function (marker) {
                var el = document.createElement('div');
                el.className = 'marker';

                new mapboxgl.Marker(el)
                    .setLngLat(marker.geometry.coordinates)
                    .setPopup(new mapboxgl.Popup({ offset: [0, -15] }) // add popups
                    .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
                    .addTo(map);
                });
            })

            map.on('click', function(e) {
                document.getElementById("long").value = e.lngLat.lng
                document.getElementById("lat").value = e.lngLat.lat
            })
            </script>
        <p></p>
    </div>    

</div>
{% endblock %}