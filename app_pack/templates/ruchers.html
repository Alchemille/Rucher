{% extends "base.html"%}
{% block content %}

{% with text="Ruchers" %}
{% include "header_theme.html" %}
{% endwith %}

<div class="jumbotron">

  <div class="container">


    <div class="row">

      {% for i in ruchers %}

      <div class="col-md-3 mb-4">

        <a href="{{ url_for('see_rucher', id=i.id) }}">
        <div class="card bg-light ">

          <div class="card-body">

            <h5>{{ i.location }}</h5>

            <p class="card-text">

            <ul class="list-group list-group-flush">

              <li class="list-group-item text-dark bg-light">FA: {{ i.frelons_asiat }}/10</li>

              <li class="list-group-item text-dark bg-light">{{ i.plants }}</li>

              {% if i.feedback %}
              <li class="list-group-item text-dark bg-light"> {{ i.feedback }}</li>
              {% endif %}

              <li class="list-group-item text-dark bg-light"> {{i.get_ruches()|length}} ruches</li>

              {% if i.events[0] %}

              <li class="list-group-item text-dark bg-light"> Derni√®re visite :
                  {{ i.events[-1].timestamp.strftime("%d/%m/%y") }}</li>
              
              {% else %}
              <li class="list-group-item text-dark bg-light"> Pas encore de visite </li>
              {% endif %}
              
            </ul>


            </p>

            <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
              <div class="btn-group mr-2" role="group" aria-label="First group">
                  <form action="{{ url_for('delete_rucher', id=i.id) }}" method="post" class="ml-auto">
                      <button class="btn btn-dark" type="submit">
                          <svg class="bi bi-trash-fill" width="15" height="15" viewBox="0 0 16 16"
                              fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd"
                                  d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z" />
                          </svg>
                      </button>
                  </form>
              </div>
              <div class="btn-group mr-2" role="group" aria-label="Second group">
                  <a href="{{ url_for('update_rucher', id=i.id) }}" class="btn btn-dark">
                      <svg width="15" height="15" viewBox="0 0 16 16" class="bi bi-pencil"
                          fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd"
                              d="M11.293 1.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-9 9a1 1 0 0 1-.39.242l-3 1a1 1 0 0 1-1.266-1.265l1-3a1 1 0 0 1 .242-.391l9-9zM12 2l2 2-9 9-3 1 1-3 9-9z" />
                          <path fill-rule="evenodd"
                              d="M12.146 6.354l-2.5-2.5.708-.708 2.5 2.5-.707.708zM3 10v.5a.5.5 0 0 0 .5.5H4v.5a.5.5 0 0 0 .5.5H5v.5a.5.5 0 0 0 .5.5H6v-1.5a.5.5 0 0 0-.5-.5H5v-.5a.5.5 0 0 0-.5-.5H3z" />
                      </svg>
                  </a>
              </div>
          </div>

          </div>

        </div>
        </a>
      </div>
      {% endfor %}
    </div>

    <div>
      <a class="btn btn-outline-secondary" href="{{url_for('add_rucher')}}">Ajouter un rucher</a>
    </div>
  </div>




</div>

<hr />

<div class="jumbotron">
  <div class="d-flex justify-content-center align-items-center">
    <div class="border border-info" id='map' style='width: 850px; height: 650px;'></div>

    <script>

      var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v11',
        center: {{ center }},
        zoom: 9.5
      });
      map.on('load', function () {

        var positions = {{ positions| safe
      }}
        positions.forEach(function (marker) {
          var el = document.createElement('div');
          el.className = 'marker';

          new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({ offset: [0, -15] }) // add popups
              .setHTML(marker.properties.title))
            .addTo(map);
        });
          })

    </script>
    <p></p>
  </div>
</div>


{% endblock %}